$(document).ready(function(){function e(e){function a(e){e.lengthComputable&&e.loaded==e.total&&t(e.target.result)}function t(e){var a=document.createElement("canvas"),t=a.getContext("2d"),n=document.createElement("img");n.onload=function(){var e,l=n.width,s=n.height;e=l>=s?s:l,$(a).attr("width",e).attr("height",e);var i=Math.floor((l-e)/2),r=Math.floor((s-e)/2),c=i+e,d=r+e;t.drawImage(n,i,r,c,d,0,0,e,e);var p=a.toDataURL("image/png");o.siblings("img").attr("src",p)},n.src=e}var o=e;if(o.val()&&window.FileReader&&window.FileList){var n=o[0].files[0],l=new FileReader;l.onload=a,l.readAsDataURL(n)}}var a=function(){return Modernizr.hasEvent("touchstart")?"touchstart":"click"},t=$("#contact-photo"),o=$("#contact-photo-input"),n=$("#job-photo"),l=$("#job-photo-input");t.on(a(),function(){o.click()}),n.on(a(),function(){l.click()}),o.on("change",function(){e($(this))}),l.on("change",function(){e($(this))}),$("input[type=phone]").keyup(function(e){var a=$(this);e.which>47&&e.which<58||e.which>92&&e.which<106||8==e.which||a.val(a.val().substring(0,a.val().length-1));var t=a.val().length;8!=e.which?3===t?a.val("("+a.val()+") "):9===t&&a.val(a.val()+"-"):9===t?a.val(a.val().substring(0,a.val().length-1)):5===t?a.val(a.val().substring(0,a.val().length-2)):1===t&&a.val("")}),$(".modal-body").on(a(),".add-phone-input-type",function(){$(".add-phone-input-type").removeClass("selected btn-primary").addClass("btn-default"),$(this).addClass("selected btn-primary")}),$("#add-phone-save").on(a(),function(){function e(){var e=0,a=$("#add-phone-input"),t=$("#add-phone-modal .alert");return t.hide().children("ul").empty(),14!=a.val().length?(a.parent().addClass("has-error"),t.children("ul").append("<li>Please enter a valid phone number</li>"),e++):a.parent().removeClass("has-error"),$(".add-phone-input-type.selected").length?$(".add-phone-input-type").eq(0).parent().parent().parent().removeClass("has-error"):($(".add-phone-input-type").eq(0).parent().parent().parent().addClass("has-error"),t.children("ul").append("<li>Please select a number type</li>"),e++),e>0?(t.slideDown(),!1):!0}var a=$("#add-phone-primary").is(":checked"),t='<button class="btn btn-default set-primary"><span class="glyphicon glyphicon-star"></span></button>',o=$("#add-phone-input").val(),n=$("#add-phone-ext-input").val(),l='<button class="btn btn-default delete-phone"><span class="glyphicon glyphicon-remove"></span></button>',s=$('<div class="row"><div class="col-xs-1">'+t+"</div>"+'<div class="col-xs-6"><input type="phone" class="form-control" value="'+o+'" /></div>'+'<div class="col-xs-3"><input type="text" class="form-control" placeholder="Ext." value="'+n+'" /></div>'+'<div class="col-xs-1">'+l+"</div></div>");if(a&&($("#phones .primary").removeClass("primary"),s.find(".glyphicon-star").addClass("primary")),e()){switch($(".add-phone-input-type.selected").text()){case"Work":$("#work-phones").append(s);break;case"Cell":$("#cell-phones").append(s);break;case"Home":$("#home-phones").append(s)}$("#add-phone-input").val(""),$("#add-phone-ext-input").val(""),$(".add-phone-input-type.selected").removeClass("selected btn-primary").addClass("btn-default"),$("#add-phone-primary").removeAttr("checked"),$("#add-phone-modal").modal("hide"),$(document).trigger("change.Phone")}}),$(document).on(a(),".delete-phone",function(){$(this).closest(".row").remove(),$(document).trigger("change.Phone")}).on(a(),"#phones .set-primary",function(){$("#phones .primary").removeClass("primary"),$(this).addClass("primary"),$(document).trigger("change.Phone")}).on("change.Phone",function(){$("#work-phones, #cell-phones, #home-phones").children("h3").each(function(){var e=$(this);e.siblings().length?e.show().parent().css("position","static"):e.hide().parent().css("position","absolute")}),$("#phones .primary").closest(".row").each(function(){$self=$(this),$self.siblings(".row").length&&$self.fadeOut().insertBefore($self.siblings(".row").eq(0)).fadeIn()})}),$("#add-email-save").on(a(),function(){function e(){var e=new RegExp(/^[A-z0-9._%+-]+@[A-z0-9.-]+\.[A-z]{2,4}$/),t=$("#add-email-modal .alert");return t.hide(),e.test(a)?!0:(t.slideDown(),!1)}var a=$("#add-email-input").val(),t=$("#add-email-primary").is(":checked"),o='<button class="btn btn-default set-primary"><span class="glyphicon glyphicon-star"></span></button>',n='<button class="btn btn-default delete-email"><span class="glyphicon glyphicon-remove"></span></button>',l=$('<div class="row"><div class="col-xs-1">'+o+"</div>"+'<div class="col-xs-9"><input type="email" class="form-control" value="'+a+'" /></div>'+'<div class="col-xs-1">'+n+"</div></div>");t&&($("#emails .primary").removeClass("primary"),l.find(".glyphicon-star").addClass("primary")),e()&&($("#email-list").append(l),$("#add-email-input").val(""),$("#add-email-primary").removeAttr("checked"),$("#add-email-modal").modal("hide"),$(document).trigger("change.Email"))}),$(document).on(a(),".delete-email",function(){$(this).closest(".row").remove(),$(document).trigger("change.Email")}).on(a(),"#emails .set-primary",function(){$("#emails .primary").removeClass("primary"),$(this).addClass("primary"),$(document).trigger("change.Email")}).on("change.Email",function(){$("#emails .primary").closest(".row").each(function(){$self=$(this),$self.siblings(".row").length&&$self.fadeOut().insertBefore($self.siblings(".row").eq(0)).fadeIn()})});for(var s=["AK","AL","AR","AS","AZ","CA","CO","CT","DC","DE","FL","GA","GU","HI","IA","ID","IL","IN","KS","KY","LA","MA","MD","ME","MH","MI","MN","MO","MS","MT","NC","ND","NE","NH","NJ","NM","NV","NY","OH","OK","OR","PA","PR","PW","RI","SC","SD","TN","TX","UT","VA","VI","VT","WA","WI","WV","WY"],i="",r=0;r<s.length;r++){var c="<option>"+s[r]+"</option>";i+=c}$('select[id$="-state-input"]').append(i);var d=$("#map-canvas");d.height(d.parent().width()),$("#get-gmap").on(a(),function(){var e=$("#job-address-input"),a=$("#job-address-zip-input"),t=$("#job-location .alert");e.parent().removeClass("has-error"),a.parent().removeClass("has-error"),t.hide(),e.val()&&a.val()?($(this).hide(),$("#map-canvas").show(),Gmaps.initialize(),Gmaps.codeAddress(e.val()+", "+a.val())):(t.slideDown(),e.val()||e.parent().addClass("has-error"),a.val()||a.parent().addClass("has-error"))}),$("#add-communication-button").on(a(),function(){var e='<div class="col-xs-11 col-sm-6"><label class="control-label">Date</label><input type="date" class="form-control" /></div>',a='<div class="col-xs-11 col-sm-5"><label class="control-label">Method</label><select class="form-control"><option>Phone</option><option>Email</option><option>In person</option></select></div>',t='<div class="col-xs-11 col-sm-11"><label class="control-label">Comments</label><textarea class="form-control" rows="5"></textarea></div>',o='<div class="col-xs-1"><br><button class="btn btn-default delete-communication"><span class="glyphicon glyphicon-remove"></span></button></div>',n='<div class="row communication-row"><div class="col-xs-11 col-sm-12"><div class="row">'+e+a+o+"</div>"+'<div class="row">'+t+"</div>"+"</div></div>";$(this).before(n)}),$(document).on(a(),".delete-communication",function(){$(this).closest(".communication-row").remove()}),$("#add-note-button").on(a(),function(){var e='<div class="col-xs-11"><label class="control-label">Title</label><input type="text" class="form-control" /></div>',a='<div class="col-xs-11"><label class="control-label">Description</label><textarea class="form-control" rows="5"></textarea></div>',t='<div class="col-xs-11 col-sm-5"><label class="control-label">Date</label><input type="date" class="form-control" /></div>',o='<div class="col-xs-11 col-sm-6"><label class="control-label">Created By</label><input type="text" class="form-control" /></div>',n='<div class="col-xs-1"><br><button class="btn btn-default delete-note"><span class="glyphicon glyphicon-remove"></span></button></div>',l='<div class="row note-row"><div class="col-xs-11 col-sm-12"><div class="row">'+e+n+"</div>"+'<div class="row">'+a+"</div>"+'<div class="row">'+t+o+"</div>"+"</div></div>";$(this).before(l)}),$(document).on(a(),".delete-communication",function(){$(this).closest(".communication-row").remove()})});